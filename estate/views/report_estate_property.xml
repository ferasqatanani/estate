<odoo>
  <!--
    Minimal, robust report:
    - Split into a wrapper template and a document template
    - No deprecated helpers; only plain fields and simple loops
    - HTML mode so wkhtmltopdf is not required
  -->

  <!-- Document content for a single record (expects variable 'o') -->
  <template id="report_estate_property_document">
    <div class="page">
      <h2>Property: <t t-esc="o.name"/></h2>
      <p>
        <strong>State:</strong> <t t-esc="o.state"/>
        <t t-if="o.property_type_id">
          · <strong>Type:</strong> <t t-esc="o.property_type_id.name"/>
        </t>
        <t t-if="o.salesperson_id">
          · <strong>Salesperson:</strong> <t t-esc="o.salesperson_id.name"/>
        </t>
      </p>

      <p>
        <strong>Expected:</strong> <t t-esc="o.expected_price or 0.0"/> <t t-esc="o.currency_id.symbol or ''"/>
        · <strong>Selling:</strong> <t t-esc="o.selling_price or 0.0"/> <t t-esc="o.currency_id.symbol or ''"/>
      </p>

      <t t-if="o.description">
        <h4>Description</h4>
        <p t-esc="o.description"/>
      </t>

      <h4>Offers (<t t-esc="len(o.offer_ids)"/>)</h4>
      <table class="table table-sm">
        <thead>
          <tr>
            <th>Buyer</th>
            <th class="text-end">Price</th>
            <th>Status</th>
            <th>Validity</th>
          </tr>
        </thead>
        <tbody>
          <t t-if="o.offer_ids">
            <t t-foreach="o.offer_ids" t-as="ofr">
              <tr>
                <td><t t-esc="ofr.partner_id.name"/></td>
                <td class="text-end">
                  <t t-esc="ofr.price or 0.0"/> <t t-esc="o.currency_id.symbol or ''"/>
                </td>
                <td><t t-esc="ofr.status"/></td>
                <td><t t-esc="ofr.validity"/></td>
              </tr>
            </t>
          </t>
          <t t-else="">
            <tr><td colspan="4" class="text-muted text-center">No offers yet</td></tr>
          </t>
        </tbody>
      </table>
    </div>
  </template>

  <!-- Wrapper iterates over docs and calls the document template -->
  <template id="report_estate_property">
    <t t-call="web.html_container">
      <t t-foreach="docs" t-as="o">
        <t t-call="estate.report_estate_property_document"/>
      </t>
    </t>
  </template>

  <!-- Report action bound to estate.property; HTML preview -->
  <record id="action_report_estate_property" model="ir.actions.report">
    <field name="name">Property Sheet</field>
    <field name="model">estate.property</field>
    <field name="report_type">qweb-html</field>
    <field name="report_name">estate.report_estate_property</field>
    <field name="report_file">estate.report_estate_property</field>
    <field name="binding_model_id" ref="estate.model_estate_property"/>
    <field name="binding_type">report</field>
    <field name="print_report_name">'Property - %s' % (object.name)</field>
  </record>
</odoo>

